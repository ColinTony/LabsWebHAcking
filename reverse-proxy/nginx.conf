
# Optional nginx.conf replacement that makes localhost/default go to scoreboard
worker_processes  1;
events { worker_connections 1024; }
http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile        on;
  keepalive_timeout  65;

  upstream scoreboard   { server scoreboard:3000; }
  upstream web_xss      { server web-xss:3000; }
  upstream web_lfi      { server web-lfi:3000; }
  upstream web_sqli     { server web-sqli:3000; }
  upstream web_xxe      { server web-xxe:3000; }
  upstream web_idor     { server web-idor:3000; }
  upstream web_csrf     { server web-csrf:3000; }
  upstream web_ssrf     { server web-ssrf:3000; }
  upstream web_upload   { server web-upload:3000; }
  upstream crackme      { server crackme:3000; }

  map $host $up {
    default         scoreboard;
    lab             scoreboard;
    localhost       scoreboard;
    127.0.0.1       scoreboard;
    xss.lab         web_xss;
    lfi.lab         web_lfi;
    sqli.lab        web_sqli;
    xxe.lab         web_xxe;
    idor.lab        web_idor;
    csrf.lab        web_csrf;
    ssrf.lab        web_ssrf;
    upload.lab      web_upload;
    crackme.lab     crackme;
    bover.lab       scoreboard;
  }

  server {
    listen 80;
    server_name _;
    location / {
      proxy_pass http://$up;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
    if ($host ~* ^bover\.lab$) { return 302 http://lab/bover; }
  }
}
